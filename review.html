<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"/>
    <script src="script.js"defer></script>
    <style>
        .public-reviews-container {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        .public-review {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .public-review:last-child {
            border-bottom: none;
        }

        .review-info {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 5px;
        }

        .review-stars {
            color: #ffcc00;
        }
    </style>
</head>
<body>
    <button class="popup">Rate Our Service</button>
    <div class="background-container">
    <img src="background.jpg" alt="Background" class="background-image"></div>
    <div class="background-overlay"></div>
    <div class="overlay"></div>
    <div class="rating-box">
        <div class="closebutton">&times;</div>
        <header>Rate us</header>
        <div class="stars">
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
            <i class="fa-solid fa-star"></i>
        </div>
        <br>
        <div class="review-section">
            <textarea id="reviewInput" placeholder="Write your review"></textarea>
            <button class="submitReview">Submit</button>
        </div>
    </div>

    <div class="public-reviews-container">
        <h2>Public Reviews</h2>
        <div id="publicReviews">
            </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const stars = document.querySelectorAll(".stars i");
            const popup = document.querySelector(".popup");
            const ratingBox = document.querySelector(".rating-box");
            const closebutton = document.querySelector(".closebutton");
            const overlay = document.querySelector(".overlay");
            const submitbutton = document.querySelector(".submitReview");
            const publicReviewsContainer = document.getElementById("publicReviews");
            let currentRating = 0;

            // Function to render stars based on a rating value
            function renderStars(rating) {
                let starsHTML = '';
                for (let i = 0; i < 5; i++) {
                    if (i < rating) {
                        starsHTML += '<i class="fa-solid fa-star review-stars"></i>';
                    } else {
                        starsHTML += '<i class="fa-solid fa-star"></i>';
                    }
                }
                return starsHTML;
            }

            // Function to display a public review
            function displayPublicReview(rating, comment, dateTime) {
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'public-review';
                const starsHTML = renderStars(rating);
                reviewDiv.innerHTML = `
                    <div class="review-info">
                        Rated: ${starsHTML} <br>
                        ${new Date(dateTime).toLocaleString()}
                    </div>
                    <p>${comment}</p>
                `;
                publicReviewsContainer.prepend(reviewDiv); // Add new reviews to the top
            }

            // pag bumubukas yung popup
            popup.addEventListener("click", () => {
                ratingBox.classList.add("active");
                overlay.classList.add("active");
            });

            // pag sumara yung popup
            function closePopup() {
                ratingBox.classList.remove("active");
                overlay.classList.remove("active");

                // nirereset yung reivew pati star rating
                stars.forEach(star => star.classList.remove("active"));
                const message = document.querySelector(".rating-message");
                if (message) message.remove();

                // Clear textarea
                document.getElementById("reviewInput").value = "";
                currentRating = 0; // Reset the current rating
            }

            closebutton.addEventListener("click", closePopup);
            overlay.addEventListener("click", closePopup);

            // Star rating functionality
            stars.forEach((star, index1) => {
                star.addEventListener("click", () => {
                    currentRating = index1 + 1;
                    // Update active state based on selection
                    stars.forEach((star, index2) => {
                        if(index1 >= index2) {
                            star.classList.add("active");
                        } else {
                            star.classList.remove("active");
                        }
                    });

                    console.log(`You rated: ${currentRating} star${currentRating > 1 ? 's' : ''}`);
                    showRatingMessage(currentRating);
                });

                // hover effects
                star.addEventListener("mouseover", () => {
                    stars.forEach((s, idx) => {
                        if(idx <= index1) {
                            s.classList.add("hover");
                        }
                    });
                });

                star.addEventListener("mouseout", () => {
                    stars.forEach(s => s.classList.remove("hover"));
                });
            });

            // function nung submit button
            submitbutton.addEventListener("click", () => {
                const reviewText = document.getElementById("reviewInput").value.trim();

                if (currentRating > 0) {
                    console.log(`Review submitted: ${currentRating} stars, Comment: ${reviewText}`);

                    // Display the submitted review publicly
                    const now = new Date();
                    displayPublicReview(currentRating, reviewText, now.toISOString());

                    // Show a confirmation message and close popup after a delay
                    let submitMessage = document.createElement("div");
                    submitMessage.className = "rating-message";
                    submitMessage.textContent = "Thanks for your feedback! Your review has been submitted.";
                    submitMessage.style.textAlign = "center";
                    submitMessage.style.marginTop = "20px";
                    submitMessage.style.fontWeight = "500";
                    submitMessage.style.color = "#295733";

                    const ratingBoxElement = document.querySelector(".rating-box");
                    if (ratingBoxElement) {
                        // Remove any existing message first
                        const existingMsg = ratingBoxElement.querySelector(".rating-message");
                        if (existingMsg) existingMsg.remove();
                        ratingBoxElement.appendChild(submitMessage);
                    }

                    // Optionally, you can close the popup after a short delay
                    setTimeout(closePopup, 1500);

                } else {
                    alert("Please select a rating before submitting!");
                }
            });

            function showRatingMessage(rating) {
                let messageElement = document.querySelector(".rating-message");

                const ratingBoxElement = document.querySelector(".rating-box");
                if (!messageElement && ratingBoxElement) {
                    messageElement = document.createElement("div");
                    messageElement.className = "rating-message";
                    ratingBoxElement.appendChild(messageElement);
                }

                if (messageElement) {
                    messageElement.textContent = `Thank you! You rated us ${rating} star${rating > 1 ? 's' : ''}!`;
                    messageElement.style.textAlign = "center";
                    messageElement.style.marginTop = "20px";
                    messageElement.style.fontWeight = "500";
                    messageElement.style.color = "#295733";
                }
            }
        });
    </script>
</body>
</html>